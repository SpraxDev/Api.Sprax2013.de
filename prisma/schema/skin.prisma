model Skin {
  id                BigInt   @id @default(dbgenerated("generate_snowflake('skin_images_id_seq'::text)"))
  imageSha256       Bytes    @unique @map("image_sha256")
  imageBytes        Bytes    @map("image_bytes")
  normalizedImageId BigInt?  @map("normalized_image_id")
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz()

  normalizedImage         Skin?  @relation("NormalizedSkin", fields: [normalizedImageId], references: [id])
  knownNonNormalizedSkins Skin[] @relation("NormalizedSkin")

  skinUrls         SkinUrl[]
  profilesSeenWith ProfileSeenSkin[]

  @@map("skins")
}

model SkinUrl {
  url              String   @id
  imageId          BigInt   @map("image_id")
  textureValue     String?  @map("texture_value")
  textureSignature String?  @map("texture_signature")
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz()

  image Skin @relation(fields: [imageId], references: [id])

  @@map("skin_urls")
}

model ProfileSeenSkin {
  profileId      String   @map("profile_id") @db.Uuid
  skinId         BigInt   @map("skin_id")
  firstSeenUsing DateTime @default(now()) @map("first_seen_using") @db.Timestamptz()
  lastSeenUsing  DateTime @default(now()) @map("last_seen_using") @db.Timestamptz()

  profile Profile @relation(fields: [profileId], references: [id])
  skin    Skin    @relation(fields: [skinId], references: [id])

  @@id([profileId, skinId])
  @@map("profile_seen_skins")
}
